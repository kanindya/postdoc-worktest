---------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/kanyaanindya/Documents/11. Interview/02. KI - MASLD/Work test/05. L
> og/ KI Work test_analysis_(21 Feb 2026).log
  log type:  text
 opened on:  21 Feb 2026, 23:03:29

. display "This log file was created on $S_DATE $S_TIME"
This log file was created on 21 Feb 2026 23:03:29

. 
. **# Load data
.         use "${result}worktest_v01.dta", clear

.         
. **# Descriptive
.         gen uppfoljning_manader = uppfoljningstid/30.4375

.         la var uppfoljning_manader "Follow-up time (in months)"

.         
.         dtable alder i.kon1 i.T_grupp1 i.riskgrupp ht crp uppfoljningstid uppfoljning
> _manader, ///
>                 by(behandlingsgrupp1) ///
>                 define(meansd = mean sd, delimiter(" ± ")) ///
>         define(myiqr = p25 p75, delimiter("-")) ///
>                 nformat(%6.0f p25 p75 median) sformat("(%s)" myiqr) ///
>                 nformat(%6.1f mean sd) sformat("%s" sd) ///
>                 continuous(crp uppfoljningstid uppfoljning_manader, stat(median myiqr
> )) ///
>                 continuous(alder ht , stat(meansd)) ///
>                 sample(, statistics(freq) place(seplabels)) sformat("(N=%s)" frequenc
> y) ///
>                 export("${excel}worktest_desc_v01.xls", replace)

---------------------------------------------------------------------------
                                            Treatment group                
                               Obehandlad      Behandlad         Total     
                                (N=207)         (N=410)         (N=617)    
---------------------------------------------------------------------------
Age at diagnosis (in years)     63.2 ± 10.8      62.7 ± 9.4      62.9 ± 9.9
The sex of the patient                                                     
  Män                           157 (75.8%)     294 (71.7%)     451 (73.1%)
  Kvinnor                        50 (24.2%)     116 (28.3%)     166 (26.9%)
Tumor group                                                                
  T1-3                          152 (73.4%)     302 (73.7%)     454 (73.6%)
  T4ab                           55 (26.6%)     108 (26.3%)     163 (26.4%)
Risk group                                                                 
  Lag risk                       90 (43.5%)     192 (46.8%)     282 (45.7%)
  Medelrisk                      62 (30.0%)     110 (26.8%)     172 (27.9%)
  Hog risk                       55 (26.6%)     108 (26.3%)     163 (26.4%)
Haematocrit (volume %)           44.0 ± 2.0      43.9 ± 2.0      43.9 ± 2.0
C-reactive protein               18 (15-21)      17 (15-20)      17 (15-20)
Follow-up time (days)       1482 (754-2231) 1575 (788-2281) 1549 (788-2256)
Follow-up time (in months)       49 (25-73)      52 (26-75)      51 (26-74)
---------------------------------------------------------------------------
(collection DTable exported to file /Users/kanyaanindya/Documents/11. Interview/02.
 KI - MASLD/Work test/03. Excel/worktest_desc_v01.xls)

.         
.         * Observe the dates
.         summ diagnosdatum, detail

                      Date of diagnosis
-------------------------------------------------------------
      Percentiles      Smallest
 1%        17608          17543
 5%        17756          17553
10%        17943          17565       Obs                 617
25%        18444          17571       Sum of wgt.         617

50%        19017                      Mean           18987.27
                        Largest       Std. dev.      705.4741
75%        19587          20088
90%        19909          20092       Variance       497693.7
95%        20008          20099       Skewness      -.2402841
99%        20082          20114       Kurtosis       1.970354

.         display "Earliest diagnosdatum: " %td r(min) // 2008-01-12
Earliest diagnosdatum: 12jan2008

.         display "Latest diagnosdatum:   " %td r(max) // 2015-01-26
Latest diagnosdatum:   26jan2015

.         
.         summ uppfoljningstid, detail

                    Follow-up time (days)
-------------------------------------------------------------
      Percentiles      Smallest
 1%           29              2
 5%           84              6
10%          224             11       Obs                 617
25%          788             20       Sum of wgt.         617

50%         1549                      Mean           1561.405
                        Largest       Std. dev.      950.7276
75%         2256           3576
90%         2912           3586       Variance       903882.9
95%         3224           3613       Skewness       .1299527
99%         3539           3641       Kurtosis       2.146986

.         display "Minimum follow-up (days): " %9.0f r(min) // 2 days
Minimum follow-up (days):         2

.         display "Maximum follow-up (days): " %9.0f r(max) // 3641 days
Maximum follow-up (days):      3641

.         
. /***********************************************
> 
> █▀▄▀█ ▄▀█ █ █▄░█   ▄▀█ █▄░█ ▄▀█ █░░ █▄█ █▀ █ █▀
> █░▀░█ █▀█ █ █░▀█   █▀█ █░▀█ █▀█ █▄▄ ░█░ ▄█ █ ▄█
> 
> ***********************************************/
. 
. **# OUTCOME 1: Overall survival
.         * Stset
.         stset uppfoljningstid, failure(dod==1) id(ID) scale(30.4375)

Survival-time data settings

           ID variable: ID
         Failure event: dod==1
Observed time interval: (uppfoljningstid[_n-1], uppfoljningstid]
     Exit on or before: failure
     Time for analysis: time/30.4375

--------------------------------------------------------------------------
        617  total observations
          0  exclusions
--------------------------------------------------------------------------
        617  observations remaining, representing
        617  subjects
        254  failures in single-failure-per-subject data
 31,651.318  total analysis time at risk and under observation
                                                At risk from t =         0
                                     Earliest observed entry t =         0
                                          Last observed exit t =  119.6222

.         
.         **# 1.1 KM curve
.         sts test behandlingsgrupp1

        Failure _d: dod==1
  Analysis time _t: uppfoljningstid/30.4375
       ID variable: ID

Equality of survivor functions
Log-rank test

             |  Observed       Expected
behandling~1 |    events         events
-------------+-------------------------
  Obehandlad |        88          83.87
   Behandlad |       166         170.13
-------------+-------------------------
       Total |       254         254.00

                       chi2(1) =   0.30
                       Pr>chi2 = 0.5814

.         
.         * Overall KM by treatment
.         qui sts graph, by(behandlingsgrupp1) ///
>                 title("Overall survival by treatment group") ///
>                 xtitle("Months of follow-up") ytitle("Survival probability") ///
>                 risktable(, order(1 "Obehandlad" 2 "Behandlad")) ///
>                 legend(order(1 "Obehandlad" 2 "Behandlad") ring(0) pos(5)) ///
>                 name(km_overall, replace)

. 
.         graph export "${figure}km_os_overall.png", replace width(2400)
file /Users/kanyaanindya/Documents/11. Interview/02. KI - MASLD/Work test/07.
    Figure/km_os_overall.png saved as PNG format

. 
.         * KM by treatment within each risk group
.         forvalues r = 0/2 {
  2.                 preserve
  3.                         keep if riskgrupp == `r'
  4. 
.                         qui sts graph, by(behandlingsgrupp1) ///
>                                 title("Overall survival by treatment, risk group: `r'
> ") ///
>                                 xtitle("Months of follow-up") ytitle("Survival probab
> ility") ///
>                                 risktable(, order(1 "Obehandlad" 2 "Behandlad")) ///
>                                 legend(order(1 "Obehandlad" 2 "Behandlad") ring(0) po
> s(5)) ///
>                                 name(km_r`r', replace)
  5. 
.                         graph export "${figure}km_os_risk`r'.png", replace width(2400
> )
  6.                 restore
  7.         }
(335 observations deleted)
file /Users/kanyaanindya/Documents/11. Interview/02. KI - MASLD/Work test/07.
    Figure/km_os_risk0.png saved as PNG format
(445 observations deleted)
file /Users/kanyaanindya/Documents/11. Interview/02. KI - MASLD/Work test/07.
    Figure/km_os_risk1.png saved as PNG format
(454 observations deleted)
file /Users/kanyaanindya/Documents/11. Interview/02. KI - MASLD/Work test/07.
    Figure/km_os_risk2.png saved as PNG format

.                 
.         **# 2.1 Cox
.         * Compare linear vs flexible models
.         use "${result}worktest_v01.dta", clear

.         stset uppfoljningstid, failure(dod==1) id(ID) scale(30.4375)

Survival-time data settings

           ID variable: ID
         Failure event: dod==1
Observed time interval: (uppfoljningstid[_n-1], uppfoljningstid]
     Exit on or before: failure
     Time for analysis: time/30.4375

--------------------------------------------------------------------------
        617  total observations
          0  exclusions
--------------------------------------------------------------------------
        617  observations remaining, representing
        617  subjects
        254  failures in single-failure-per-subject data
 31,651.318  total analysis time at risk and under observation
                                                At risk from t =         0
                                     Earliest observed entry t =         0
                                          Last observed exit t =  119.6222

.         
.         stcox i.behandlingsgrupp1 c.alder1 i.kon1 i.T_grupp1 c.ht c.crp

        Failure _d: dod==1
  Analysis time _t: uppfoljningstid/30.4375
       ID variable: ID

Iteration 0:  Log likelihood = -1531.9828
Iteration 1:  Log likelihood = -1465.7238
Iteration 2:  Log likelihood =  -1463.818
Iteration 3:  Log likelihood = -1463.8177
Refining estimates:
Iteration 0:  Log likelihood = -1463.8177

Cox regression with Breslow method for ties

No. of subjects =         617                           Number of obs =    617
No. of failures =         254
Time at risk    = 31,651.3183
                                                        LR chi2(6)    = 136.33
Log likelihood = -1463.8177                             Prob > chi2   = 0.0000

-----------------------------------------------------------------------------------
               _t | Haz. ratio   Std. err.      z    P>|z|     [95% conf. interval]
------------------+----------------------------------------------------------------
behandlingsgrupp1 |
       Behandlad  |   1.019072   .1358697     0.14   0.887     .7847241    1.323406
           alder1 |   1.067548    .007717     9.04   0.000      1.05253    1.082781
                  |
             kon1 |
         Kvinnor  |   .9659708   .1359413    -0.25   0.806     .7331186    1.272781
                  |
         T_grupp1 |
            T4ab  |   2.363725    .305347     6.66   0.000      1.83501    3.044777
               ht |   1.030488   .0316309     0.98   0.328     .9703207    1.094386
              crp |   1.001475   .0159955     0.09   0.926       .97061    1.033321
-----------------------------------------------------------------------------------

.         
.         * Check non-linearity
.         cap drop mart

.         predict mart, mgale

.         lowess mart alder1 // result: non-linear

.         lowess mart ht // result: linear

.         lowess mart crp // result: linear

.         
.         notes: age is non-linear, so use Restricted cubic splines

.         
.         * Stcox with spline age model
.         mkspline age_s = alder1, cubic nknots(4)

.         stcox i.behandlingsgrupp1 age_s* i.kon1 i.T_grupp1 c.ht c.crp

        Failure _d: dod==1
  Analysis time _t: uppfoljningstid/30.4375
       ID variable: ID

Iteration 0:  Log likelihood = -1531.9828
Iteration 1:  Log likelihood = -1468.1523
Iteration 2:  Log likelihood = -1460.4567
Iteration 3:  Log likelihood = -1460.2842
Iteration 4:  Log likelihood = -1460.2832
Iteration 5:  Log likelihood = -1460.2832
Refining estimates:
Iteration 0:  Log likelihood = -1460.2832

Cox regression with Breslow method for ties

No. of subjects =         617                           Number of obs =    617
No. of failures =         254
Time at risk    = 31,651.3183
                                                        LR chi2(8)    = 143.40
Log likelihood = -1460.2832                             Prob > chi2   = 0.0000

-----------------------------------------------------------------------------------
               _t | Haz. ratio   Std. err.      z    P>|z|     [95% conf. interval]
------------------+----------------------------------------------------------------
behandlingsgrupp1 |
       Behandlad  |    1.07214   .1453774     0.51   0.607     .8219252    1.398526
           age_s1 |   1.055557    .033493     1.70   0.088     .9919111    1.123286
           age_s2 |   .9571455   .0741118    -0.57   0.572      .822374    1.114003
           age_s3 |   1.425713   .4665314     1.08   0.278     .7507516    2.707497
                  |
             kon1 |
         Kvinnor  |   .9484503    .133733    -0.38   0.707     .7194387    1.250361
                  |
         T_grupp1 |
            T4ab  |    2.34302   .3045146     6.55   0.000     1.816135    3.022761
               ht |   1.023099   .0315321     0.74   0.459     .9631267    1.086805
              crp |   1.004204   .0160261     0.26   0.793      .973279    1.036111
-----------------------------------------------------------------------------------

.         estimates store cox_spline

.         
.         * Proportional hazards check
.         estat phtest, detail

Test of proportional-hazards assumption

Time function: Analysis time
--------------------------------------------------------
             |        rho     chi2       df    Prob>chi2
-------------+------------------------------------------
0b.behandl~1 |          .        .        1           .
1.behandli~1 |   -0.03828     0.39        1       0.5343
      age_s1 |   -0.05013     1.18        1       0.2780
      age_s2 |    0.05067     1.11        1       0.2912
      age_s3 |   -0.05022     1.01        1       0.3161
     0b.kon1 |          .        .        1           .
      1.kon1 |   -0.10448     2.71        1       0.0999
 0b.T_grupp1 |          .        .        1           .
  1.T_grupp1 |   -0.00122     0.00        1       0.9844
          ht |    0.02942     0.22        1       0.6415
         crp |    0.08600     1.94        1       0.1633
-------------+------------------------------------------
 Global test |                6.95        8       0.5418
--------------------------------------------------------

.         
. **# OUTCOME 2: Complication-free
.         **# 2.2 Cox
.         use "${result}worktest_v01.dta", clear

.         stset cr_time, failure(failtype==1) id(ID) scale(30.4375)

Survival-time data settings

           ID variable: ID
         Failure event: failtype==1
Observed time interval: (cr_time[_n-1], cr_time]
     Exit on or before: failure
     Time for analysis: time/30.4375

--------------------------------------------------------------------------
        617  total observations
          0  exclusions
--------------------------------------------------------------------------
        617  observations remaining, representing
        617  subjects
         52  failures in single-failure-per-subject data
 29,863.392  total analysis time at risk and under observation
                                                At risk from t =         0
                                     Earliest observed entry t =         0
                                          Last observed exit t =  119.6222

. 
.         * Cause specific Cox for complication with spline age
.         mkspline age_s = alder1, cubic nknots(4)

.         stcox i.behandlingsgrupp1 age_s* i.kon1 i.T_grupp1 c.ht c.crp

        Failure _d: failtype==1
  Analysis time _t: cr_time/30.4375
       ID variable: ID

Iteration 0:  Log likelihood = -309.35697
Iteration 1:  Log likelihood = -303.85451
Iteration 2:  Log likelihood = -303.63181
Iteration 3:  Log likelihood = -303.63042
Iteration 4:  Log likelihood = -303.63042
Refining estimates:
Iteration 0:  Log likelihood = -303.63042

Cox regression with Breslow method for ties

No. of subjects =         617                           Number of obs =    617
No. of failures =          52
Time at risk    = 29,863.3922
                                                        LR chi2(8)    =  11.45
Log likelihood = -303.63042                             Prob > chi2   = 0.1773

-----------------------------------------------------------------------------------
               _t | Haz. ratio   Std. err.      z    P>|z|     [95% conf. interval]
------------------+----------------------------------------------------------------
behandlingsgrupp1 |
       Behandlad  |   2.795017   1.079949     2.66   0.008     1.310672    5.960394
           age_s1 |   1.000677   .0449268     0.02   0.988     .9163853    1.092722
           age_s2 |   1.051315   .1463182     0.36   0.719     .8003237     1.38102
           age_s3 |   .6235228    .464448    -0.63   0.526     .1448144    2.684683
                  |
             kon1 |
         Kvinnor  |   .9029411   .2915523    -0.32   0.752     .4795274    1.700221
                  |
         T_grupp1 |
            T4ab  |   .9261865   .3284084    -0.22   0.829     .4622515    1.855746
               ht |   .9382561   .0666603    -0.90   0.370      .816293    1.078442
              crp |   1.013936   .0337694     0.42   0.678     .9498634    1.082331
-----------------------------------------------------------------------------------

.         estimates store comp_cs_spline

.         estat phtest, detail

Test of proportional-hazards assumption

Time function: Analysis time
--------------------------------------------------------
             |        rho     chi2       df    Prob>chi2
-------------+------------------------------------------
0b.behandl~1 |          .        .        1           .
1.behandli~1 |   -0.23593     3.03        1       0.0817
      age_s1 |    0.23506     5.17        1       0.0229
      age_s2 |   -0.25060     4.82        1       0.0282
      age_s3 |    0.21498     3.01        1       0.0828
     0b.kon1 |          .        .        1           .
      1.kon1 |    0.16479     1.46        1       0.2270
 0b.T_grupp1 |          .        .        1           .
  1.T_grupp1 |   -0.17260     1.51        1       0.2192
          ht |    0.09651     0.50        1       0.4779
         crp |    0.01251     0.01        1       0.9330
-------------+------------------------------------------
 Global test |               11.09        8       0.1967
--------------------------------------------------------

.         
.         * Competing risks Fine and Gray for complication with death as competing even
> t
.         stcrreg i.behandlingsgrupp1 age_s* i.kon1 i.T_grupp1 c.ht c.crp, compete(fail
> type==2)

        Failure _d: failtype==1
  Analysis time _t: cr_time/30.4375
       ID variable: ID

Iteration 0:  Log pseudolikelihood =  -317.3463  
Iteration 1:  Log pseudolikelihood = -316.40101  
Iteration 2:  Log pseudolikelihood = -316.38193  
Iteration 3:  Log pseudolikelihood = -316.38192  

Competing-risks regression                        No. of obs      =        617
                                                  No. of subjects =        617
Failure event:   failtype == 1                    No. failed      =         52
Competing event: failtype == 2                    No. competing   =        243
                                                  No. censored    =        322

                                                  Wald chi2(8)    =      13.11
Log pseudolikelihood = -316.38192                 Prob > chi2     =     0.1081

                                        (Std. err. adjusted for 617 clusters in ID)
-----------------------------------------------------------------------------------
                  |               Robust
               _t |        SHR   std. err.      z    P>|z|     [95% conf. interval]
------------------+----------------------------------------------------------------
behandlingsgrupp1 |
       Behandlad  |   2.791426   1.099912     2.61   0.009     1.289511    6.042643
           age_s1 |   .9872923    .055989    -0.23   0.822     .8834347     1.10336
           age_s2 |   1.078422    .172246     0.47   0.636     .7885596    1.474833
           age_s3 |   .4862996   .3796381    -0.92   0.356     .1052928    2.245996
                  |
             kon1 |
         Kvinnor  |   .8894036   .2906112    -0.36   0.720     .4687812    1.687437
                  |
         T_grupp1 |
            T4ab  |   .7026387   .2495057    -0.99   0.320     .3503257    1.409263
               ht |   .9423445   .0689978    -0.81   0.417     .8163668    1.087762
              crp |   1.017727   .0314933     0.57   0.570     .9578358    1.081363
-----------------------------------------------------------------------------------

.         estimates store comp_fg_spline

.         
.         * Model-based CIF curves at treatment levels
.         stcurve, cif ///
>                 at1(behandlingsgrupp1=0) ///
>                 at2(behandlingsgrupp1=1) ///
>                 title("Cumulative incidence of complications by treatment group") ///
>                 xtitle("Months of follow-up") ///
>                 ytitle("Cumulative incidence of complication") ///
>                 legend(order(1 "Obehandlad" 2 "Behandlad") ring(0) pos(5)) ///
>                 name(cif_comp_fg_overall, replace) 
note: function evaluated at specified values of selected covariates and overall means
      of other covariates (if any).

.         
. /***********************************
> 
> █▀ █▀▀ █▄░█ █▀ █ ▀█▀ █ █░█ █ ▀█▀ █▄█
> ▄█ ██▄ █░▀█ ▄█ █ ░█░ █ ▀▄▀ █ ░█░ ░█░
> 
> ************************************/
. 
. **# Sensivity analysis 1: IPTW  
.         use "${result}worktest_v01.dta", clear

.         
.         * Generate the propensity score (Denominator)
.         logit behandlingsgrupp1 c.alder i.kon1 i.T_grupp1 c.ht c.crp

Iteration 0:  Log likelihood = -393.64696  
Iteration 1:  Log likelihood = -391.45682  
Iteration 2:  Log likelihood = -391.45424  
Iteration 3:  Log likelihood = -391.45424  

Logistic regression                                     Number of obs =    617
                                                        LR chi2(5)    =   4.39
                                                        Prob > chi2   = 0.4954
Log likelihood = -391.45424                             Pseudo R2     = 0.0056

-----------------------------------------------------------------------------------
behandlingsgrupp1 | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
------------------+----------------------------------------------------------------
            alder |  -.0057692   .0088193    -0.65   0.513    -.0230547    .0115162
                  |
             kon1 |
         Kvinnor  |   .2022258   .1976096     1.02   0.306    -.1850818    .5895334
                  |
         T_grupp1 |
            T4ab  |   .0001225    .195901     0.00   1.000    -.3838364    .3840814
               ht |  -.0276205   .0434598    -0.64   0.525    -.1128001    .0575592
              crp |  -.0316253   .0205826    -1.54   0.124    -.0719664    .0087157
            _cons |   2.783623   2.034774     1.37   0.171    -1.204461    6.771706
-----------------------------------------------------------------------------------

.         predict double ps, pr

. 
.         * Check positivity and overlap
.         summ ps if behandlingsgrupp1==0

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
          ps |        207    .6597075    .0416561   .5083336   .7434268

.         summ ps if behandlingsgrupp1==1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
          ps |        410    .6669282    .0388874   .4771102   .7597563

.         
.         scalar p_treat = r(mean)

. 
.         gen double sw = .
(617 missing values generated)

.         replace sw = (p_treat/ps) if behandlingsgrupp1==1
(410 real changes made)

.         replace sw = ((1-p_treat)/(1-ps)) if behandlingsgrupp1==0
(207 real changes made)

.         label var sw "Stabilised IPTW"

.         
.         _pctile sw, p(1 99)

.         scalar w_lo = r(r1)

.         scalar w_hi = r(r2)

. 
.         gen double sw_tr = sw

.         replace sw_tr = w_lo if sw_tr < w_lo
(6 real changes made)

.         replace sw_tr = w_hi if sw_tr > w_hi
(6 real changes made)

.         label var sw_tr "Stabilised IPTW truncated at p1 p99"

.         
.         * Check balance before and after weighting
.         pstest c.alder i.kon1 i.T_grupp1 i.riskgrupp ht crp, both mw(sw_tr) treated(b
> ehandlingsgrupp1)

---------------------------------------------------------------------------------------
> -
                Unmatched |       Mean               %reduct |     t-test    |  V(T)/
Variable          Matched | Treated Control    %bias  |bias| |    t    p>|t| |  V(C)
--------------------------+----------------------------------+---------------+---------
> -
alder                  U  | 62.683   63.203     -5.1         |  -0.62  0.537 |  0.75*
                       M  | 62.683    62.79     -1.1    79.5 |  -0.13  0.900 |  0.74*
                          |                                  |               |
1.kon1                 U  | .28293   .24155      9.4         |   1.09  0.275 |     .
                       M  | .28293   .27058      2.8    70.2 |   0.32  0.748 |     .
                          |                                  |               |
1.T_grupp1             U  | .26341    .2657     -0.5         |  -0.06  0.952 |     .
                       M  | .26341   .26299      0.1    81.4 |   0.01  0.991 |     .
                          |                                  |               |
1.riskgrupp            U  | .26829   .29952     -6.9         |  -0.82  0.415 |     .
                       M  | .26829   .28809     -4.4    36.6 |  -0.52  0.604 |     .
                          |                                  |               |
2.riskgrupp            U  | .26341    .2657     -0.5         |  -0.06  0.952 |     .
                       M  | .26341   .26299      0.1    81.4 |   0.01  0.991 |     .
                          |                                  |               |
ht                     U  | 43.915   44.015     -5.1         |  -0.60  0.550 |  0.94
                       M  | 43.915   43.966     -2.6    49.1 |  -0.30  0.761 |  0.95
                          |                                  |               |
crp                    U  | 17.932   18.493    -13.5         |  -1.61  0.108 |  0.82
                       M  | 17.932   18.126     -4.7    65.4 |  -0.57  0.572 |  0.90
                          |                                  |               |
---------------------------------------------------------------------------------------
> -
* if variance ratio outside [0.82; 1.21] for U and [0.82; 1.21] for M

-----------------------------------------------------------------------------------
 Sample    | Ps R2   LR chi2   p>chi2   MeanBias   MedBias      B      R     %Var
-----------+-----------------------------------------------------------------------
 Unmatched | 0.006      4.78    0.572      5.9       5.1      18.6    0.88     33
 Matched   | 0.001      0.90    0.989      2.2       2.6       8.1    0.97     33
-----------------------------------------------------------------------------------
* if B>25%, R outside [0.5; 2]

. 
.         **# OUTCOME 1: Overall survival, IPTW
.                 * Stcox with spline age model
.                 stset uppfoljningstid [pweight=sw_tr], failure(dod==1)

Survival-time data settings

         Failure event: dod==1
Observed time interval: (0, uppfoljningstid]
     Exit on or before: failure
                Weight: [pweight=sw_tr]

--------------------------------------------------------------------------
        617  total observations
          0  exclusions
--------------------------------------------------------------------------
        617  observations remaining, representing
        254  failures in single-record/single-failure data
    963,387  total analysis time at risk and under observation
                                                At risk from t =         0
                                     Earliest observed entry t =         0
                                          Last observed exit t =     3,641

.                 
.                 mkspline age_s = alder1, cubic nknots(4)

.                 stcox i.behandlingsgrupp1 age_s* i.kon1 i.T_grupp1 c.ht c.crp

        Failure _d: dod==1
  Analysis time _t: uppfoljningstid
            Weight: [pweight=sw_tr]

(sum of wgt is 617.0971099585587)
Iteration 0:  Log pseudolikelihood =  -1522.973
Iteration 1:  Log pseudolikelihood = -1458.4356
Iteration 2:  Log pseudolikelihood = -1450.4273
Iteration 3:  Log pseudolikelihood = -1450.2054
Iteration 4:  Log pseudolikelihood = -1450.2038
Iteration 5:  Log pseudolikelihood = -1450.2038
Refining estimates:
Iteration 0:  Log pseudolikelihood = -1450.2038

Cox regression with Breslow method for ties

No. of subjects =         617                           Number of obs =    617
No. of failures =         252
Time at risk    = 966,497.561
                                                        Wald chi2(8)  = 128.63
Log pseudolikelihood = -1450.2038                       Prob > chi2   = 0.0000

-----------------------------------------------------------------------------------
                  |               Robust
               _t | Haz. ratio   std. err.      z    P>|z|     [95% conf. interval]
------------------+----------------------------------------------------------------
behandlingsgrupp1 |
       Behandlad  |   1.084968   .1532964     0.58   0.564     .8225259    1.431147
           age_s1 |   1.063919   .0451295     1.46   0.144     .9790437    1.156152
           age_s2 |   .9395184   .0928437    -0.63   0.528     .7740858    1.140306
           age_s3 |   1.541618   .6197624     1.08   0.282     .7010934    3.389826
                  |
             kon1 |
         Kvinnor  |   .9246619   .1349495    -0.54   0.591     .6946317    1.230868
                  |
         T_grupp1 |
            T4ab  |   2.345234    .316442     6.32   0.000     1.800254    3.055193
               ht |   1.025901   .0307204     0.85   0.393     .9674225    1.087913
              crp |   1.004622   .0142276     0.33   0.745     .9771195    1.032898
-----------------------------------------------------------------------------------

.                 
.         **# OUTCOME 2: Complications-free, IPTW
.                 * FG with spline age model, death as competing risk
.                 stset cr_time [pweight=sw_tr], failure(failtype==1) id(ID) scale(30.4
> 375)

Survival-time data settings

           ID variable: ID
         Failure event: failtype==1
Observed time interval: (cr_time[_n-1], cr_time]
     Exit on or before: failure
     Time for analysis: time/30.4375
                Weight: [pweight=sw_tr]

--------------------------------------------------------------------------
        617  total observations
          0  exclusions
--------------------------------------------------------------------------
        617  observations remaining, representing
        617  subjects
         52  failures in single-failure-per-subject data
 29,863.392  total analysis time at risk and under observation
                                                At risk from t =         0
                                     Earliest observed entry t =         0
                                          Last observed exit t =  119.6222

.                 stcrreg i.behandlingsgrupp1 age_s* i.kon1 i.T_grupp1 c.ht c.crp, comp
> ete(failtype==2)

        Failure _d: failtype==1
  Analysis time _t: cr_time/30.4375
       ID variable: ID
            Weight: [pweight=sw_tr]

Iteration 0:  Log pseudolikelihood = -322.49717  
Iteration 1:  Log pseudolikelihood = -321.51141  
Iteration 2:  Log pseudolikelihood = -321.49106  
Iteration 3:  Log pseudolikelihood = -321.49105  

Competing-risks regression                        No. of obs      =        617
                                                  No. of subjects =        617
Failure event:   failtype == 1                    No. failed      =         52
Competing event: failtype == 2                    No. competing   =        243
                                                  No. censored    =        322

                                                  Wald chi2(8)    =      12.81
Log pseudolikelihood = -321.49105                 Prob > chi2     =     0.1187

                                        (Std. err. adjusted for 617 clusters in ID)
-----------------------------------------------------------------------------------
                  |               Robust
               _t |        SHR   std. err.      z    P>|z|     [95% conf. interval]
------------------+----------------------------------------------------------------
behandlingsgrupp1 |
       Behandlad  |   2.641829   1.028861     2.49   0.013     1.231413    5.667682
           age_s1 |   .9891985   .0560024    -0.19   0.848     .8853063    1.105283
           age_s2 |   1.070436   .1698008     0.43   0.668      .784398     1.46078
           age_s3 |   .5074863   .3908221    -0.88   0.378     .1121766    2.295865
                  |
             kon1 |
         Kvinnor  |   .9144974   .2988736    -0.27   0.784     .4819423    1.735281
                  |
         T_grupp1 |
            T4ab  |   .6966977   .2479853    -1.02   0.310     .3467882    1.399666
               ht |   .9436114   .0694574    -0.79   0.430     .8168417    1.090055
              crp |   1.018392   .0311016     0.60   0.551     .9592221    1.081211
-----------------------------------------------------------------------------------

.                 
.         
. **# Sensivity analysis 2: Effect moderation of risk group
.         use "${result}worktest_v01.dta", clear

.         
.         notes: age and tumour were excluded since risk group were included in the mod
> el

.         **# OUTCOME 1: Overall survival, effect modration
.                 * Stcox with spline age model
.                 stset uppfoljningstid, failure(dod==1)

Survival-time data settings

         Failure event: dod==1
Observed time interval: (0, uppfoljningstid]
     Exit on or before: failure

--------------------------------------------------------------------------
        617  total observations
          0  exclusions
--------------------------------------------------------------------------
        617  observations remaining, representing
        254  failures in single-record/single-failure data
    963,387  total analysis time at risk and under observation
                                                At risk from t =         0
                                     Earliest observed entry t =         0
                                          Last observed exit t =     3,641

.                 
.                 mkspline age_s = alder1, cubic nknots(4)

.                 stcox i.behandlingsgrupp1##i.riskgrupp i.kon1 c.ht c.crp

        Failure _d: dod==1
  Analysis time _t: uppfoljningstid

Iteration 0:  Log likelihood = -1531.9828
Iteration 1:  Log likelihood =  -1492.917
Iteration 2:  Log likelihood = -1491.5205
Iteration 3:  Log likelihood = -1491.5169
Refining estimates:
Iteration 0:  Log likelihood = -1491.5169

Cox regression with Breslow method for ties

No. of subjects =     617                               Number of obs =    617
No. of failures =     254
Time at risk    = 963,387
                                                        LR chi2(8)    =  80.93
Log likelihood = -1491.5169                             Prob > chi2   = 0.0000

--------------------------------------------------------------------------------------
                  _t | Haz. ratio   Std. err.      z    P>|z|     [95% conf. interval]
---------------------+----------------------------------------------------------------
   behandlingsgrupp1 |
          Behandlad  |   1.213969   .3214735     0.73   0.464     .7224359    2.039933
                     |
           riskgrupp |
          Medelrisk  |   3.306041   .9349749     4.23   0.000     1.899248    5.754861
           Hog risk  |   4.423694   1.253521     5.25   0.000      2.53854    7.708787
                     |
   behandlingsgrupp1#|
           riskgrupp |
Behandlad#Medelrisk  |   .5902761   .2056176    -1.51   0.130     .2982266    1.168326
 Behandlad#Hog risk  |   .8029671   .2713814    -0.65   0.516     .4140134    1.557332
                     |
                kon1 |
            Kvinnor  |   .9804701    .138387    -0.14   0.889     .7435202    1.292933
                  ht |   1.017215    .032097     0.54   0.589     .9562115     1.08211
                 crp |    1.00001   .0158269     0.00   0.999     .9694665    1.031517
--------------------------------------------------------------------------------------

.                 
.         **# OUTCOME 2: Overall survival, effect modration
.                 * FG with spline age model, death as competing risk
.                 stset cr_time, failure(failtype==1) id(ID) scale(30.4375)

Survival-time data settings

           ID variable: ID
         Failure event: failtype==1
Observed time interval: (cr_time[_n-1], cr_time]
     Exit on or before: failure
     Time for analysis: time/30.4375

--------------------------------------------------------------------------
        617  total observations
          0  exclusions
--------------------------------------------------------------------------
        617  observations remaining, representing
        617  subjects
         52  failures in single-failure-per-subject data
 29,863.392  total analysis time at risk and under observation
                                                At risk from t =         0
                                     Earliest observed entry t =         0
                                          Last observed exit t =  119.6222

.                 stcrreg i.behandlingsgrupp1##i.riskgrupp i.kon1 c.ht c.crp, compete(f
> ailtype==2)

        Failure _d: failtype==1
  Analysis time _t: cr_time/30.4375
       ID variable: ID

Iteration 0:  Log pseudolikelihood =  -317.9931  
Iteration 1:  Log pseudolikelihood = -317.27433  
Iteration 2:  Log pseudolikelihood = -317.27085  
Iteration 3:  Log pseudolikelihood = -317.27085  

Competing-risks regression                        No. of obs      =        617
                                                  No. of subjects =        617
Failure event:   failtype == 1                    No. failed      =         52
Competing event: failtype == 2                    No. competing   =        243
                                                  No. censored    =        322

                                                  Wald chi2(8)    =      10.09
Log pseudolikelihood = -317.27085                 Prob > chi2     =     0.2585

                                           (Std. err. adjusted for 617 clusters in ID)
--------------------------------------------------------------------------------------
                     |               Robust
                  _t |        SHR   std. err.      z    P>|z|     [95% conf. interval]
---------------------+----------------------------------------------------------------
   behandlingsgrupp1 |
          Behandlad  |   1.867549   .8514661     1.37   0.171     .7641633    4.564128
                     |
           riskgrupp |
          Medelrisk  |   .2514657   .2738481    -1.27   0.205     .0297518    2.125416
           Hog risk  |   .2700365   .2907584    -1.22   0.224     .0327267    2.228143
                     |
   behandlingsgrupp1#|
           riskgrupp |
Behandlad#Medelrisk  |   3.791114   4.322588     1.17   0.242     .4057289    35.42401
 Behandlad#Hog risk  |   2.646544   3.035343     0.85   0.396     .2795304    25.05701
                     |
                kon1 |
            Kvinnor  |   .8580444   .2819842    -0.47   0.641     .4505826    1.633974
                  ht |   .9372434   .0693196    -0.88   0.381     .8107679    1.083448
                 crp |   1.017605   .0313396     0.57   0.571     .9579971    1.080921
--------------------------------------------------------------------------------------

.                 
.         
. 
.         
. 
end of do-file

. do "/var/folders/1h/8pp9ldg93jz93bymwdj6m5140000gn/T//SD05647.000000"

. /*----------------------------------------------------------------------
> 
> ------------------------------------------------------------------------
> Author          : Kanya Anindya 
> Project         : Causal treatment effects on survival and complications
> Email           : kanyaanin@gmail.com
> Version         : v01, 21-Feb-2026
> ------------------------------------------------------------------------
> Data cleaning and management
> ----------------------------------------------------------------------*/
.         
. set more 1

. cap log close
